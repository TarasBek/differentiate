!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("differentiate",["exports","@angular/core","@angular/common"],t):t(e.differentiate={},e.ng.core,e.ng.common)}(this,function(e,t,r){"use strict";var s={literal:1,pair:2,json:3,array:4};s[s.literal]="literal",s[s.pair]="pair",s[s.json]="json",s[s.array]="array";var h={"default":1,typeChanged:2,nameChanged:3,valueChanged:4,added:5,removed:6};h[h["default"]]="default",h[h.typeChanged]="typeChanged",h[h.nameChanged]="nameChanged",h[h.valueChanged]="valueChanged",h[h.added]="added",h[h.removed]="removed";var i=function(){function e(){this.allowRevert=!1,this.attributeOrderIsImportant=!0,this.onlyShowDifferences=!1,this.onrevert=new t.EventEmitter}return e.prototype.generateNodeId=function(){return Math.floor(1e4*Math.random())+1},e.prototype.transformNodeToOriginalStructure=function(e,r){var i=this,n={},d=[];return e.map(function(e){if(r===s.json)if(e.type===s.literal)d.push(e.value);else if(e.type===s.pair)n[e.name]=e.value;else if(e.type===s.array){var t=i.transformNodeToOriginalStructure(e.children,e.parent);e.name.length?n[e.name]=t:n=[t]}else e.type===s.json&&(n[e.name]=i.transformNodeToOriginalStructure(e.children,e.parent));else r===s.array&&(e.type===s.literal?d.push(e.value):e.type===s.json?d.push(i.transformNodeToOriginalStructure(e,e.parent)):e.type===s.array&&d.push(i.transformNodeToOriginalStructure(e.children,e.parent)))}),d.length?d:n},e.prototype.transformNodeToInternalStruction=function(i){var n=this,e=i;if(i instanceof Array){var d=[],o=s.array;i.map(function(e,t){var r=n.transformNodeToInternalStruction(e);r instanceof Array?(n.attributeOrderIsImportant||(r.sort(function(e,t){return e.name<=t.name?-1:1}),r.map(function(e,t){e.index=t,e.altName=""+t})),d.push({id:n.generateNodeId(),index:t,name:"",altName:""+t,value:"",parent:o,type:s.array,status:h["default"],children:r})):d.push({id:n.generateNodeId(),index:t,name:"",altName:""+t,value:r,parent:o,type:s.literal,status:h["default"],children:[]})}),e=d}else if(i instanceof Object){var t=Object.keys(i),a=[],l=s.json;this.attributeOrderIsImportant||t.sort(function(e,t){return e<=t?-1:1}),t.map(function(e,t){var r=n.transformNodeToInternalStruction(i[e]);r instanceof Array?(n.attributeOrderIsImportant||(r.sort(function(e,t){return e.name<=t.name?-1:1}),r.map(function(e,t){e.index=t,e.altName=""+t})),a.push({id:n.generateNodeId(),index:t,name:e,altName:""+t,value:"",parent:l,type:s.json,status:h["default"],children:r})):a.push({id:n.generateNodeId(),index:t,name:e,altName:""+t,value:r,parent:l,type:s.pair,status:h["default"],children:[]})}),e=a}return e},e.prototype.itemInArray=function(e,t){var r,i=t.type===s.literal?t.value.toUpperCase():t.type===s.array?t.altName:t.name;return e.map(function(e){e.type===s.literal?e.value.toUpperCase()===i&&(r=e):e.type===s.array?e.altName===i&&(r=e):e.name===i&&(r=e)}),r},e.prototype.leftItemFromRightItem=function(e,t){var r;if(!e||!t)return r;var i=t.type===s.literal?t.value.toUpperCase():t.type===s.array?t.altName:t.name;return e.type===s.literal?e.value.toUpperCase()===i&&(r=e):e.type===s.array?e.altName===i&&(r=e):e.name===i&&(r=e),r},e.prototype.compare=function(e,t){e.type!==t.type?(e.status=h.typeChanged,t.status=h.typeChanged,e.counterpart=t.id,t.counterpart=e.id):e.type===s.literal?e.value!==t.value&&(e.status=h.valueChanged,t.status=h.valueChanged,e.counterpart=t.id,t.counterpart=e.id):e.type===s.pair?(e.name!==t.name&&(e.status=h.nameChanged,t.status=h.nameChanged,e.counterpart=t.id,t.counterpart=e.id),e.value!==t.value&&(e.status=h.valueChanged,t.status=h.valueChanged,e.counterpart=t.id,t.counterpart=e.id)):(e.name!==t.name&&(e.status=h.nameChanged,t.status=h.nameChanged,e.counterpart=t.id,t.counterpart=e.id),this.unify(e.children,t.children))},e.prototype.reIndex=function(e){var r=this;e.map(function(e,t){e.index=t,r.reIndex(e.children)})},e.prototype.copyInto=function(e,t,r,i){var n=JSON.parse(JSON.stringify(t));e.splice(r,0,n),this.reIndex(e),t.status=i,n.status=i,t.counterpart=n.id,n.counterpart=t.id,this.setChildrenStatus(t.children,i),this.setChildrenStatus(n.children,i)},e.prototype.setChildrenStatus=function(e,t){var r=this;e.map(function(e){e.status=t,r.setChildrenStatus(e.children,t)})},e.prototype.unify=function(e,t){for(var r=0,i=0,n=!0;n;){var d,o=r<e.length?this.itemInArray(t,e[r]):undefined,a=i<t.length?this.itemInArray(e,t[i]):undefined;if(!o&&r<e.length)if(t.length)this.copyInto(t,e[r],r,h.removed),i++,r++;else for(;r<e.length;)this.copyInto(t,e[r],r,h.removed),i++,r++;if(!a&&i<t.length)if(e.length)this.copyInto(e,t[i],i,h.added),i++,r++;else for(;i<t.length;)this.copyInto(e,t[i],i,h.added),i++,r++;if(o||(o=i<t.length?t[i]:undefined),a||(a=r<e.length?e[r]:undefined),o&&o.index!==r)for(;r<e.length;){if(o=this.leftItemFromRightItem(t[r],e[r])){o=i<t.length?t[i]:undefined;break}this.copyInto(t,e[r],r,h.removed),i++,r++}if(a&&a.index!==i)for(;i<t.length;){if(a=this.leftItemFromRightItem(e[i],t[i])){a=r<e.length?e[r]:undefined;break}this.copyInto(e,t[i],i,h.added),i++,r++}if(o&&r<e.length)(d=this.itemInArray(t,e[r]))&&d.index!==o.index&&(this.copyInto(e,t[i],i,h.added),r++,o=++i<t.length?t[i]:undefined);if(a&&i<t.length)(d=this.itemInArray(e,t[i]))&&d.index!==a.index&&(this.copyInto(t,e[r],r,h.removed),i++,a=++r<e.length?e[r]:undefined);o&&a&&(o.parent!==a.parent?(this.copyInto(e,t[i],i,h.added),this.copyInto(t,e[r],r,h.removed)):this.compare(o,a),i++,r++),n=r<e.length||i<t.length}},e.prototype.toInternalStruction=function(e,t){var r={leftSide:this.transformNodeToInternalStruction(e),rightSide:this.transformNodeToInternalStruction(t)};return this.unify(r.leftSide,r.rightSide),this.onlyShowDifferences&&(r.leftSide=this.filterUnchanged(r.leftSide),r.rightSide=this.filterUnchanged(r.rightSide)),r},e.prototype.filterUnchanged=function(e){var t=this,r=[];return e.map(function(e){e.children=t.filterUnchanged(e.children),(e.type>s.pair&&e.children.length||e.status!==h["default"])&&r.push(e)}),r.map(function(e,t){e.index=t,e.altName=""+t}),r},e.prototype.ngOnChanges=function(e){e.attributeOrderIsImportant&&this.ngOnInit(),e.onlyShowDifferences&&this.ngOnInit(),e.leftSideObject&&this.ngOnInit(),e.rightSideObject&&this.ngOnInit()},e.prototype.ngOnInit=function(){if(this.leftSideObject&&this.rightSideObject){var e=this.toInternalStruction(this.leftSideObject,this.rightSideObject);this.leftSide=[{id:this.generateNodeId(),name:"",value:"Root Object",parent:s.array,type:s.array,expanded:!0,isRoot:!0,children:e.leftSide}],this.rightSide=[{id:this.generateNodeId(),name:"",value:"Root Object",parent:s.array,type:s.array,expanded:!0,isRoot:!0,children:e.rightSide}]}},e.prototype.lookupChildOf=function(t,r){var i=this,n=undefined;return t.children.length?t.children.map(function(e){n||((n=i.lookupChildOf(e,r))&&n.parent===undefined?n.parent=t:e.id===r&&(n={parent:t,node:e}))}):t.id===r&&(n={parent:undefined,node:t}),n},e.prototype.revert=function(e){var t=this.lookupChildOf(this.leftSide[0],e.counterpart),r=this.lookupChildOf(this.rightSide[0],e.id);e.status===h.added?(t.parent.children.splice(t.node.index,1),r.parent.children.splice(r.node.index,1),this.reIndex(t.parent.children),this.reIndex(r.parent.children)):e.status===h.removed?(r.node.status=h["default"],t.node.status=h["default"],this.setChildrenStatus(t.node.children,t.node.status),this.setChildrenStatus(r.node.children,r.node.status)):e.status===h.nameChanged?(r.node.name=t.node.name,r.node.status=h["default"],t.node.status=h["default"],this.setChildrenStatus(t.node.children,t.node.status),this.setChildrenStatus(r.node.children,r.node.status)):e.status===h.valueChanged?(r.node.value=t.node.value,r.node.status=h["default"],t.node.status=h["default"],this.setChildrenStatus(t.node.children,t.node.status),this.setChildrenStatus(r.node.children,r.node.status)):e.status===h.typeChanged&&(r.node.type=t.node.type,r.node.status=h["default"],t.node.status=h["default"],this.setChildrenStatus(t.node.children,t.node.status),r.node.children=t.node.children),this.onrevert.emit(this.transformNodeToOriginalStructure(this.rightSide[0].children,s.json))},e.prototype.onhover=function(e){var t;(t="left-side"==e.side?this.rightSide[0].children:this.leftSide[0].children).length>e.index&&(t[e.index].hover=e.hover)},e}();i.decorators=[{type:t.Component,args:[{selector:"differentiate",template:'<differentiate-tree \n    class="root" \n    level="0" \n    side="left-side" \n    (onhover)="onhover($event)"\n    [children]="leftSide"></differentiate-tree>\n<differentiate-tree \n    class="root" \n    level="0" \n    side="right-side" \n    [showActionButton]="allowRevert" \n    (onhover)="onhover($event)"\n    (onrevert)="revert($event)"\n    [children]="rightSide"></differentiate-tree>\n\n',styles:[":host{border:1px solid #444;-webkit-box-sizing:border-box;box-sizing:border-box;display:block;max-width:100vw;max-height:300px;overflow-y:auto;position:relative;width:100%}"]}]}],i.ctorParameters=function(){return[]},i.propDecorators={allowRevert:[{type:t.Input,args:["allowRevert"]}],attributeOrderIsImportant:[{type:t.Input,args:["attributeOrderIsImportant"]}],onlyShowDifferences:[{type:t.Input,args:["onlyShowDifferences"]}],leftSideObject:[{type:t.Input,args:["leftSideObject"]}],rightSideObject:[{type:t.Input,args:["rightSideObject"]}],onrevert:[{type:t.Output,args:["onrevert"]}]};var n=function(){function e(){this.showActionButton=!1,this.status=1,this.level="0",this.onhover=new t.EventEmitter,this.onrevert=new t.EventEmitter}return e.prototype.ngOnInit=function(){this.depth=parseInt(this.level)},e.prototype.bubleup=function(e){e.side=this.side,this.onhover.emit(e)},e.prototype.keyup=function(e){13===e.which&&e.target.click()},e.prototype.undo=function(e){this.onrevert.emit(e)},e.prototype.revert=function(e){this.onrevert.emit(e)},e.prototype.mouseOvered=function(e,t){1===this.depth&&this.onhover.emit({hover:e,index:t,side:this.side})},e}();n.decorators=[{type:t.Component,args:[{selector:"differentiate-tree",template:'<ul [class]="side">\n  <li  *ngFor="let child of children" \n    (mouseout)="mouseOvered(false, child.index)"\n    (mouseover)="mouseOvered(true, child.index)"\n    [class.hover]="child.hover"\n    [class.added]="child.status === 5" \n    [class.removed]="child.status === 6" \n    [class.type-changed]="child.status === 2" \n    [class.name-changed]="child.status === 3" \n    [class.value-changed]="child.status === 4">\n    <div class=\'tree-node\'\n        [ngClass]="\'depth-\' + depth"\n        [id] = "child.id">\n      <span *ngIf=\'child.name && child.name!=null\'\n        class=\'name\' \n        [innerHTML]="child.name.length ? child.name : \'&nbsp;\'">\n      </span>\n      <span *ngIf=\'child.value && child.value!=null\'\n        class=\'value\' \n        [class.string]="depth > 0 && child.value && child.value.length"\n        [innerHTML]="child.value ? child.value : \'&nbsp;\'">\n      </span>\n      <span title="Undo"\n        class="undo" \n        tabindex="0"\n        aria-hidden="true"\n        (keyup)="keyup($event)"\n        (click)="undo(child)"\n        *ngIf="showActionButton && status !== child.status && child.status > 1">&#x238c;</span>\n    </div>\n    <differentiate-tree *ngIf="child.children.length" \n        [level]="depth+1" \n        [status]="child.status" \n        [showActionButton]="showActionButton" \n        (onhover)="bubleup($event)"\n        (onrevert)="revert($event)"\n        [class.child-node]="child.parent != 4" \n        [children]=\'child.children\'></differentiate-tree>\n    <div class="upper" [ngClass]="\'depth-\' + depth" *ngIf="child.status > 2"></div>\n    <div class="lower" [ngClass]="\'depth-\' + depth" *ngIf="child.status > 2"></div>\n  </li>\n</ul>\n\n',styles:[":host{-webkit-box-sizing:border-box;box-sizing:border-box;display:inline-block;width:100%}:host.root{float:left;width:50%}:host.child-node{float:left}ul{-webkit-box-sizing:border-box;box-sizing:border-box;list-style:none;padding:0;width:100%}ul li .hover{background-color:#ddd}ul li .tree-node{position:relative}ul li .tree-node .undo{position:absolute;width:18px;height:18px;right:0;margin:0 5px 0 0;cursor:pointer;font-weight:700;font-size:1.2rem;color:#9e2525}ul.undefined li:hover{background-color:#ddd}ul.left-side{border-right:1px solid #444;display:inline-block;margin:0}ul.left-side li{position:relative;display:table;width:100%}ul.left-side li.added .name,ul.left-side li.added .value{opacity:.2;font-style:italic}ul.left-side li.added .upper{border-radius:0 0 100%;-webkit-box-sizing:border-box;box-sizing:border-box;height:50%;position:absolute;pointer-events:none;width:50%;top:0;right:0}ul.left-side li.added .upper.depth-1{border:2px solid #285828;border-top-width:0;border-left-width:0}ul.left-side li.added .upper.depth-2{border:2px dotted #3f9c3f;border-top-width:0;border-left-width:0}ul.left-side li.added .upper.depth-3{border:1px solid #57d657;border-top-width:0;border-left-width:0}ul.left-side li.added .upper.depth-4{border:1px dotted #57d657;border-top-width:0;border-left-width:0}ul.left-side li.added .upper.depth-5{border:1px dashed #57d657;border-top-width:0;border-left-width:0}ul.left-side li.added .lower{border-radius:0 100% 0 0;-webkit-box-sizing:border-box;box-sizing:border-box;height:50%;position:absolute;pointer-events:none;width:50%;bottom:0;right:0}ul.left-side li.added .lower.depth-1{border:2px solid #2c612c;border-bottom-width:0;border-left-width:0}ul.left-side li.added .lower.depth-2{border:2px dotted #3f9c3f;border-bottom-width:0;border-left-width:0}ul.left-side li.added .lower.depth-3{border:1px solid #57d657;border-bottom-width:0;border-left-width:0}ul.left-side li.added .lower.depth-4{border:1px dotted #57d657;border-bottom-width:0;border-left-width:0}ul.left-side li.added .lower.depth-5{border:1px dashed #57d657;border-bottom-width:0;border-left-width:0}ul.left-side li.removed .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;width:66px;top:0;right:0;pointer-events:none}ul.left-side li.removed .upper:after{content:' - ';color:red;float:right;padding-right:10px;font-size:20px;line-height:16px}ul.left-side li.removed .lower{display:none}ul.left-side li.removed .tree-node span,ul.left-side li.type-changed .tree-node span{color:red}ul.left-side li.name-changed .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;width:66px;top:0;right:0;pointer-events:none}ul.left-side li.name-changed .upper:after{content:' ~ ';color:#00f;font-weight:700;float:right;padding-right:10px;font-size:20px;line-height:16px}ul.left-side li.name-changed .tree-node .name{color:#00f}ul.left-side li.value-changed .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;pointer-events:none;width:66px;top:0;right:0}ul.left-side li.value-changed .upper:after{content:' ~ ';color:#00f;font-weight:700;float:right;padding-right:10px;font-size:20px;line-height:16px}ul.left-side li.value-changed .tree-node .value{color:#00f}ul.right-side{border-left:1px solid #444;display:inline-block;margin:0}ul.right-side li{position:relative;display:table;width:100%}ul.right-side li.added .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;pointer-events:none;width:90%;top:0;left:0}ul.right-side li.added .upper:after{content:'+';color:#4a4;font-weight:700;padding-left:5px;font-size:20px;line-height:16px}ul.right-side li.added .lower{display:none}ul.right-side li.added .tree-node span{color:#4a4}ul.right-side li.removed .name,ul.right-side li.removed .value{-webkit-text-decoration-line:line-through;text-decoration-line:line-through;-webkit-text-decoration-color:#ff0600;text-decoration-color:#ff0600}ul.right-side li.removed .upper{border-radius:0 0 0 100%;-webkit-box-sizing:border-box;box-sizing:border-box;height:50%;width:10%;position:absolute;pointer-events:none;top:0}ul.right-side li.removed .upper.depth-1{border:2px solid #700000;border-top-width:0;border-right-width:0}ul.right-side li.removed .upper.depth-2{border:2px dotted #ca0303;border-top-width:0;border-right-width:0}ul.right-side li.removed .upper.depth-3{border:1px solid red;border-top-width:0;border-right-width:0}ul.right-side li.removed .upper.depth-4{border:1px dotted red;border-top-width:0;border-right-width:0}ul.right-side li.removed .upper.depth-5{border:1px dashed red;border-top-width:0;border-right-width:0}ul.right-side li.removed .lower{border-radius:100% 0 0;-webkit-box-sizing:border-box;box-sizing:border-box;height:50%;width:10%;position:absolute;pointer-events:none;bottom:0}ul.right-side li.removed .lower.depth-1{border:2px solid #700000;border-bottom-width:0;border-right-width:0}ul.right-side li.removed .lower.depth-2{border:2px dotted #ca0303;border-bottom-width:0;border-right-width:0}ul.right-side li.removed .lower.depth-3{border:1px solid red;border-bottom-width:0;border-right-width:0}ul.right-side li.removed .lower.depth-4{border:1px dotted red;border-bottom-width:0;border-right-width:0}ul.right-side li.removed .lower.depth-5{border:1px dashed red;border-bottom-width:0;border-right-width:0}ul.right-side li.type-changed .tree-node span{color:red}ul.right-side li.name-changed .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;pointer-events:none;top:0;left:0}ul.right-side li.name-changed .upper:before{content:' ~ ';color:#00f;font-weight:700;float:right;padding-left:5px;font-size:20px;line-height:16px}ul.right-side li.name-changed .tree-node .name{color:#00f}ul.right-side li.value-changed .upper{-webkit-box-sizing:border-box;box-sizing:border-box;height:100%;position:absolute;pointer-events:none;top:0;left:0}ul.right-side li.value-changed .upper:before{content:' ~ ';color:#00f;font-weight:700;float:right;padding-left:5px;font-size:20px;line-height:16px}ul.right-side li.value-changed .tree-node .value{color:#00f}ul .tree-node{-webkit-box-sizing:border-box;box-sizing:border-box;color:#7c9eb2;display:table;padding:0;position:relative;margin:0;width:100%}ul .tree-node.depth-0{padding-left:5px}ul .tree-node.depth-1{padding-left:20px}ul .tree-node.depth-2{padding-left:40px}ul .tree-node.depth-3{padding-left:60px}ul .tree-node.depth-4{padding-left:80px}ul .tree-node.depth-5{padding-left:100px}ul .tree-node.depth-6{padding-left:120px}ul .tree-node.depth-7{padding-left:140px}ul .tree-node.depth-8{padding-left:160px}ul .tree-node.depth-9{padding-left:180px}ul .tree-node.depth-10{padding-left:200px}ul .tree-node .name{color:#444;font-weight:700}ul .tree-node .name:after{content:':'}ul .tree-node .value.string:after,ul .tree-node .value.string:before{content:'\"'}"]}]}],n.propDecorators={children:[{type:t.Input,args:["children"]}],showActionButton:[{type:t.Input,args:["showActionButton"]}],status:[{type:t.Input,args:["status"]}],side:[{type:t.Input,args:["side"]}],level:[{type:t.Input,args:["level"]}],onhover:[{type:t.Output,args:["onhover"]}],onrevert:[{type:t.Output,args:["onrevert"]}]};var d=function o(){};d.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule],declarations:[i,n],exports:[i],entryComponents:[],providers:[],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],e.DifferentiateComponent=i,e.DifferentiateTree=n,e.DifferentiateModule=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=differentiate.umd.min.js.map
